<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Calculadora Taller - Comederos</title>
<style>
    /* RESET Y ESTILOS BASE */
    * { box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; padding: 15px; background-color: #f4f7f6; margin: 0; }
    
    /* CONTENEDOR PRINCIPAL */
    .app-container { background: white; padding: 20px; border-radius: 12px; max-width: 100%; margin: 0 auto; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
    
    /* TITULOS */
    h2 { color: #2c3e50; font-size: 1.5rem; text-align: center; margin-bottom: 20px; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
    h3 { color: #34495e; font-size: 1.2rem; margin-top: 0; }
    
    /* FORMULARIO */
    label { display: block; margin-top: 15px; font-weight: 600; color: #555; font-size: 1rem; }
    
    select, input[type="number"] { 
        width: 100%; 
        padding: 15px; /* Zona t√°ctil grande para dedos */
        margin-top: 8px; 
        border: 1px solid #bdc3c7; 
        border-radius: 8px; 
        font-size: 16px; /* Evita zoom autom√°tico en iPhone */
        background-color: #fff;
        -webkit-appearance: none; /* Quita estilos por defecto de iOS */
    }

    /* BOTON */
    button { 
        width: 100%; 
        padding: 18px; 
        margin-top: 25px; 
        background-color: #27ae60; 
        color: white; 
        font-size: 18px; 
        font-weight: bold; 
        border: none; 
        border-radius: 8px; 
        cursor: pointer; 
        box-shadow: 0 4px 0 #219150; /* Efecto 3D */
        transition: transform 0.1s;
    }
    button:active { transform: translateY(4px); box-shadow: none; }

    /* RESULTADOS */
    .resultado { margin-top: 30px; display: none; }
    
    .card { 
        background: #fff; 
        border: 1px solid #e0e0e0; 
        border-radius: 10px; 
        margin-bottom: 20px; 
        overflow: hidden; 
    }
    
    .card-header { 
        padding: 15px; 
        font-weight: bold; 
        color: white; 
    }
    .header-angulo { background-color: #e67e22; }
    .header-varilla { background-color: #8e44ad; }
    .header-solera { background-color: #2980b9; }

    .card-body { padding: 15px; }

    .resumen-compra {
        font-size: 1.2rem;
        font-weight: bold;
        color: #333;
        margin-bottom: 10px;
        padding-bottom: 10px;
        border-bottom: 1px dashed #ccc;
    }

    .detalle-tramos { font-size: 0.9rem; color: #666; }
    .barra-item { 
        background-color: #f9f9f9; 
        padding: 10px; 
        border-left: 4px solid #ccc; 
        margin-bottom: 8px; 
    }
    .sobrante { color: #c0392b; font-weight: bold; font-size: 0.85rem; display: block; margin-top: 4px;}

    /* RESPONSIVE PARA TABLETS/PC */
    @media (min-width: 768px) {
        .app-container { max-width: 600px; padding: 30px; }
    }
</style>
</head>
<body>

<div class="app-container">
    <h2>üõ†Ô∏è Calculadora de Materiales</h2>
    
    <label for="tipo">Modelo:</label>
    <select id="tipo">
        <option value="2m">Comedero de 2 Metros</option>
        <option value="3m">Comedero de 3 Metros</option>
    </select>

    <label for="cantidad">Cantidad a fabricar:</label>
    <input type="number" id="cantidad" value="1" min="1" inputmode="numeric" pattern="[0-9]*">

    <button onclick="ejecutarCalculo()">CALCULAR AHORA</button>

    <div id="contenedorResultados" class="resultado">
        </div>
</div>

<script>
    // --- CONFIGURACI√ìN DE TRAMOS (LARGOS STANDARD) ---
    const STOCK_ANGULO = 6.0;  // 6 metros
    const STOCK_VARILLA = 7.5; // 7.5 metros
    const STOCK_SOLERA = 6.0;  // 6 metros

    function ejecutarCalculo() {
        let tipo = document.getElementById('tipo').value;
        let cantidad = parseInt(document.getElementById('cantidad').value) || 0;

        if (cantidad < 1) { alert("Ingresa una cantidad v√°lida"); return; }

        // 1. DEFINIR PIEZAS NECESARIAS (en metros)
        let cortesAngulo = [];
        let cortesVarilla = [];
        let cortesSolera = [];

        for (let i = 0; i < cantidad; i++) {
            if (tipo === "2m") {
                // √Ångulo (2m)
                cortesAngulo.push(2.0, 2.0, 0.60, 0.60);
                // Varilla (2m)
                cortesVarilla.push(3.0, 3.0, 0.60, 0.60, 0.58);
            } else {
                // √Ångulo (3m)
                cortesAngulo.push(3.0, 3.0, 0.60, 0.60);
                // Varilla (3m)
                cortesVarilla.push(4.0, 4.0, 0.60, 0.60, 0.58);
            }
            // Solera (Igual para ambos)
            cortesSolera.push(0.91, 0.91, 0.91, 0.63, 0.63);
        }

        // 2. EJECUTAR OPTIMIZACI√ìN
        let resultadoAngulo = optimizarCortes(cortesAngulo, STOCK_ANGULO);
        let resultadoVarilla = optimizarCortes(cortesVarilla, STOCK_VARILLA);
        let resultadoSolera = optimizarCortes(cortesSolera, STOCK_SOLERA);

        // 3. GENERAR HTML
        let html = "";
        
        html += crearTarjetaHTML("√Ångulo", STOCK_ANGULO, resultadoAngulo, "header-angulo");
        html += crearTarjetaHTML("Varilla Petrolera", STOCK_VARILLA, resultadoVarilla, "header-varilla");
        html += crearTarjetaHTML("Solera", STOCK_SOLERA, resultadoSolera, "header-solera");

        let divRes = document.getElementById('contenedorResultados');
        divRes.innerHTML = html;
        divRes.style.display = 'block';
    }

    // --- ALGORITMO DE OPTIMIZACI√ìN (Best Fit Decreasing) ---
    function optimizarCortes(piezasRequeridas, largoStock) {
        // A. Ordenar piezas de MAYOR a MENOR (Clave para optimizar)
        piezasRequeridas.sort((a, b) => b - a);

        let tramosUsados = []; // Aqu√≠ guardaremos cada barra nueva y sus cortes

        // B. Iterar sobre cada pieza que necesitamos
        piezasRequeridas.forEach(pieza => {
            let tramoIdeal = -1;

            // Buscar en los tramos ya iniciados si cabe la pieza
            for (let i = 0; i < tramosUsados.length; i++) {
                if (tramosUsados[i].espacioLibre >= pieza) {
                    tramoIdeal = i;
                    break; // Encontramos lugar, dejamos de buscar (First Fit)
                }
            }

            if (tramoIdeal !== -1) {
                // Si cabe en uno existente, la metemos ah√≠
                tramosUsados[tramoIdeal].cortes.push(pieza);
                tramosUsados[tramoIdeal].espacioLibre -= pieza;
            } else {
                // Si no cabe, agarramos un TRAMO NUEVO
                if (pieza > largoStock) {
                    alert("¬°ALERTA! Una pieza de " + pieza + "m es m√°s grande que el tramo de " + largoStock + "m");
                }
                tramosUsados.push({
                    cortes: [pieza],
                    espacioLibre: largoStock - pieza
                });
            }
        });

        return tramosUsados;
    }

    // --- GENERADOR DE HTML VISUAL ---
    function crearTarjetaHTML(nombreMaterial, largoStock, datos, claseColor) {
        let totalTramos = datos.length;
        
        let html = `<div class="card">
            <div class="card-header ${claseColor}">
                ${nombreMaterial} (Tramos de ${largoStock}m)
            </div>
            <div class="card-body">
                <div class="resumen-compra">
                    üõí Comprar: ${totalTramos} tramos
                </div>
                <div class="detalle-tramos">`;

        // Generar lista de cortes por cada tramo
        datos.forEach((tramo, index) => {
            let cortesTexto = tramo.cortes.join("m + ") + "m";
            // Correcci√≥n de punto flotante para mostrar sobrante limpio
            let sobrante = Math.round(tramo.espacioLibre * 100) / 100;
            
            html += `<div class="barra-item">
                <strong>Tramo ${index + 1}:</strong> Cortar piezas de: <br>
                ${cortesTexto}
                <span class="sobrante">Desperdicio: ${sobrante}m</span>
            </div>`;
        });

        html += `</div></div></div>`;
        return html;
    }
</script>

</body>

</html>
